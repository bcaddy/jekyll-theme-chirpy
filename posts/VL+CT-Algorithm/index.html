<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="VL+CT Algorithm" /><meta name="author" content="Robert Caddy" /><meta property="og:locale" content="en_US" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://robertcaddy.com/posts/VL+CT-Algorithm/" /><meta property="og:url" content="https://robertcaddy.com/posts/VL+CT-Algorithm/" /><meta property="og:site_name" content="Robert ‘Bob’ Caddy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-06T14:44:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="VL+CT Algorithm" /> <script type="application/ld+json"> {"datePublished":"2021-01-06T14:44:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://robertcaddy.com/posts/VL+CT-Algorithm/"},"description":"Overview","url":"https://robertcaddy.com/posts/VL+CT-Algorithm/","@type":"BlogPosting","author":{"@type":"Person","name":"Robert Caddy"},"headline":"VL+CT Algorithm","dateModified":"2021-05-17T14:49:31-04:00","@context":"https://schema.org"}</script><title>VL+CT Algorithm | Robert 'Bob' Caddy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Robert 'Bob' Caddy"><meta name="application-name" content="Robert 'Bob' Caddy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/icons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Robert 'Bob' Caddy</a></div><div class="site-subtitle font-italic">Ph.D Candidate, Third Year University of Pittsburgh</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-satellite-dish ml-xl-3 mr-xl-3 unloaded"></i> <span>RESEARCH BLOG</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/research/" class="nav-link"> <i class="fa-fw fas fa-flask ml-xl-3 mr-xl-3 unloaded"></i> <span>RESEARCH</span> </a><li class="nav-item"> <a href="/community-and-outreach/" class="nav-link"> <i class="fa-fw fas fa-users ml-xl-3 mr-xl-3 unloaded"></i> <span>COMMUNITY OUTREACH</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-envelope ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/cv/" class="nav-link"> <i class="fa-fw fas fa-scroll ml-xl-3 mr-xl-3 unloaded"></i> <span>CURRICULUM VITAE</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-scroll ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bcaddy" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['r.caddy','pitt.edu'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/robertcaddy1/" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>VL+CT Algorithm</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>VL+CT Algorithm</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Robert Caddy </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 6, 2021, 2:44 PM -0500" prep="on" > Jan 6 <i class="unloaded">2021-01-06T14:44:00-05:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, May 17, 2021, 2:49 PM -0400" prefix="Updated " > May 17 <i class="unloaded">2021-05-17T14:49:31-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1629 words">9 min</span></div></div><div class="post-content"><h1 id="overview">Overview</h1><p>This is a step through of the VL+CT (Van Leer plus Constrained Transport) integrator I’m going to add to my <a href="https://github.com/bcaddy/hydro-sandbox">hydro-sandbox</a> code. The specific algorithm is from <a href="https://ui.adsabs.harvard.edu/abs/2009NewA...14..139S/abstract">Stone &amp; Gardiner 2009</a> which is the original paper where the VL+CT integrator was introduced. This will serve as practice and figuring out any kinks before I add the VL+CT integrator to <a href="https://github.com/cholla-hydro/cholla">Cholla</a>.</p><p>Overall the algorithm is very similar to the Van Leer algorithm, though with significant new additions for Constrained Transport(CT). CT treats the magnetic field as surface, rather than volume, averaged quantities then updates using edge averaged electric fields. By updating with electric fields you automatically fulfill the divergence free condition for magnetic fields so no magnetic monopoles will appear (assuming that the initial conditions don’t contain any).</p><h2 id="glossary-of-symbols">Glossary of Symbols</h2><ul><li>\( \vec{U} \), Vector of conserved variables. Note that the magnetic field is the face averaged value at the \( i-1/2 \) interface whereas all the other values are volume averages<li>\( \vec{W} \), Vector of primitive variables.<li>\( \vec{F} \), The flux vector<li>\( x, y, \text{or} z \), Subscript to indicate which vector element is in use<li>\( i, j, k \), Subscript indices to indicate which cell the value is in<li>\( n \), Superscript index to indicate the time step<li>\( \delta t \), the time step<li>\( \delta x, \delta y, \delta z \), the size of each cell in the \(x)\, \(y)\, or \(z)\ direction<li>\(\rho \), Density<li>\(p \), Pressure<li>\(E \), Energy<li>\(v \), Velocity<li>\(B \), Magnetic Field<li>\(p_T \), Total pressure<li>\( \mathcal{E} \), the electric field<li>\( C_{CFL} \), the CFL number, must be less than 1/2</ul><h2 id="glossary-of-new-equations">Glossary of New Equations</h2><p>MHD comes along with many modifications to the various basic equations that we’re used to; new terms in the pressure and energy equations, new wave speeds, new eigenvalues etc. The glossary can be found in my post on the <a href="/posts/HLLD-Algorithm/">HLLD Algorithm</a></p><h1 id="algorithm">Algorithm</h1><p>Our goal is to choose the correct HLLD flux depending on the interface states.</p><h2 id="1-compute-the-time-step">1. Compute the Time Step</h2><p>The first thing we need to do is compute the time step which is done with this equation</p>\[\delta t = C_{CFL} \min \left( \frac{\delta x}{\mid v^n_{x,i,j,k} \mid + C^n_{f,i,j,k}}, \frac{\delta y}{\mid v^n_{y,i,j,k} \mid + C^n_{f,i,j,k}}, \frac{\delta z}{\mid v^n_{z,i,j,k} \mid + C^n_{f,i,j,k}} \right).\]<p>Where \( C^n_f \) is the fast magnetosonic wave-speed computed using <em>cell centered</em> values. Computing the cell centered magnetic field is done with a direct average of the face centered values. This cell centered magnetic field will be needed in the next two steps so make sure to keep it.</p>\[\begin{aligned} B^n_{x,i,j,k,} = \frac{1}{2} \left( B^n_{x,i+1/2,j,k} + B^n_{x,i-1/2,j,k} \right) \\ B^n_{y,i,j,k,} = \frac{1}{2} \left( B^n_{y,i,j+1/2,k} + B^n_{y,i,j-1/2,k} \right) \\ B^n_{z,i,j,k,} = \frac{1}{2} \left( B^n_{z,i,j,k+1/2} + B^n_{z,i,j,k-1/2} \right) \\ \end{aligned}\]<h2 id="2-first-riemann-solve">2. First Riemann Solve</h2><p>The next step is the solve the Riemann problem with the first order variables. This is identical to the standard Van Leer integrator for the hydrodynamic variables; the magnetic field is a bit more complicated since the magnetic field is stored as surface averages. The longitudinal field (i.e. the field that is stored at the interface itself) does not require reconstruction and can be used directly. The transverse fields (i.e. the fields parallel to the interface) are reconstructed using a straight average, which has already been done in step 1.</p><p>The magnetic fluxes that are returned by the Riemann solver are the face centered electric fields (section 5.3 of Stone et. al 2008)</p><h2 id="3-compute-the-constrained-transport-electric-fields">3. Compute the Constrained Transport Electric Fields</h2><p>Now we need to calculate the CT electric fields. These fields are <em>line averaged</em> along each cell edge. These line averaged fields are constructed by a complicated average of the face centered electric fields and their slopes which are given by the flux of the magnetic field from the Riemann solve in the previous step; i.e. the magnetic flux at a given interface is the electric field at that interface.</p><p>On any face there are two non-zero electric fields; both transverse to the face. The most important thing to note is that the component that is used to calculate the field along a given edge is the component that is parallel to that edge. i.e. if the edge points along the \( z \)-direction then you use the field pointing along the \( z \)-direction, not the field in the \( x \) or \( y \) direction.</p><p>We also need cell centered electric fields (reference fields) for computing the slopes. This reference field can just be computed with the following cross product.</p>\[\mathcal{E}_{i,j,k}^{ref,n} = - \left( \vec{v}^{n}_{i.j.k} \times \vec{B}^{n}_{i.j.k} \right)\]<p>Example for computing the CT electric field in the \( z \)-direction. The other direction can be computed by just substituting out the \( z \) index with \( x \) or \( y \) and changing the derivatives appropriately, see the image in this section for more details on derivatives. The following three equations are from Stone &amp; Gardiner 2009, equations 22-24. In the original paper there are multiple sign errors which have been fixed in the document.</p>\[\begin{aligned} \mathcal{E}_{z, i-1/2, j-1/2, k} = \frac{1}{4} \left( - \mathcal{E}_{z, i-1/2, j, k} + \mathcal{E}_{z, i, j-1/2, k} - \mathcal{E}_{z, i-1/2, j-1, k} + \mathcal{E}_{z, i-1, j-1/2, k}\right) \\ + \frac{\delta y}{8} \left( \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i-1/2, j-1/4, k} + \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i-1/2, j-3/4, k} \right) \\ + \frac{\delta x}{8} \left( \left( \frac{\partial \mathcal{E}_z }{\partial x} \right)_{i-1/4, j-1/2, k} + \left( \frac{\partial \mathcal{E}_z }{\partial x} \right)_{i-3/4, j-1/2, k} \right) \end{aligned}\]<p>Where the derivatives are computed using the “upwind” direction as follows.</p>\[\left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i-1/2, j-1/4, k} = \begin{cases} \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i-1, j-1/4, k} &amp; \text{for} \; v_{x, i-1/2} &gt; 0 \\ \\ \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i, j-1/4, k} &amp; \text{for} \; v_{x, i-1/2} &lt; 0 \\ \\ \frac{1}{2} \left( \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i-1, j-1/4, k} + \left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i, j-1/4, k} \right) &amp; \text{otherwise} \\ \\ \end{cases}\]<p>Where, for example, the derivatives are given by</p>\[\left( \frac{\partial \mathcal{E}_z }{\partial y} \right)_{i, j-1/4, k} = 2 \left( \frac{\mathcal{E}_{z,i,j-1/2,k} - \mathcal{E}_{z,i,j,k}^{ref}}{\delta y} \right).\]<p>The easiest way to see how to compute these derivatives is with the following diagram from <a href="https://iopscience.iop.org/article/10.1086/588755/pdf">Stone et al. 2008</a>. Each edge requires 4 derivatives (in 3D anyway) and they are computed as differences between a reference state and an edge state.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-post-assets/01-January/Stone-et-al.-2008-fig-5.png" alt="Stone et al. 2008 Fig. 5" /></p><h2 id="4-perform-the-half-time-step-update">4. Perform the Half Time-step Update</h2><p>Update all the hydro variables using this equation</p>\[\begin{aligned} \vec{U}^{n+1/2}_{i,j,k} = \vec{U}^{n}_{i,j,k} - \frac{\delta t}{\delta x} \left( \vec{F}^n_{x,i+1/2,j,k} - \vec{F}^n_{x,i-1/2,j,k} \right) \\ - \frac{\delta t}{\delta y} \left( \vec{F}^n_{y,i+1/2,j,k} - \vec{F}^n_{y,i-1/2,j,k} \right) \\ - \frac{\delta t}{\delta z} \left( \vec{F}^n_{z,i+1/2,j,k} - \vec{F}^n_{z,i-1/2,j,k} \right). \end{aligned}\]<p>Update the magnetic field using these equations</p>\[\begin{aligned} B^{n+1/2}_{x,i-1/2,j,k} = B^{n}_{x,i-1/2,j,k} - \frac{\delta t}{\delta y} \left( \mathcal{E}^n_{z,i-1/2,j+1/2,k} - \mathcal{E}^n_{z,i-1/2,j-1/2,k} \right) \\ + \frac{\delta t}{\delta z} \left( \mathcal{E}^n_{y,i-1/2,j,k+1/2} - \mathcal{E}^n_{y,i-1/2,j,k-1/2} \right) \end{aligned}\] \[\begin{aligned} B^{n+1/2}_{y,i,j-1/2,k} = B^{n}_{y,i,j-1/2,k} + \frac{\delta t}{\delta x} \left( \mathcal{E}^n_{z,i+1/2,j-1/2,k} - \mathcal{E}^n_{z,i-1/2,j-1/2,k} \right) \\ - \frac{\delta t}{\delta z} \left( \mathcal{E}^n_{x,i,j-1/2,k+1/2} - \mathcal{E}^n_{x,i,j-1/2,k-1/2} \right) \end{aligned}\] \[\begin{aligned} B^{n+1/2}_{z,i,j,k-1/2} = B^{n}_{z,i-1/2,j,k} - \frac{\delta t}{\delta x} \left( \mathcal{E}^n_{y,i+1/2,j,k-1/2} - \mathcal{E}^n_{y,i-1/2,j,k-1/2} \right) \\ + \frac{\delta t}{\delta y} \left( \mathcal{E}^n_{x,i,j+1/2,k-1/2} - \mathcal{E}^n_{x,i,j-1/2,k-1/2} \right). \end{aligned}\]<h2 id="5-compute-cell-centered-magnetic-fields">5. Compute Cell Centered Magnetic Fields</h2><p>Average the values on the faces to compute the cell centered magnetic fields. We’ll need this for the second order reconstruction.</p>\[\begin{aligned} B^{n+1/2}_{x,i,j,k,} = \frac{1}{2} \left( B^{n+1/2}_{x,i+1/2,j,k} + B^{n+1/2}_{x,i-1/2,j,k} \right) \\ B^{n+1/2}_{y,i,j,k,} = \frac{1}{2} \left( B^{n+1/2}_{y,i,j+1/2,k} + B^{n+1/2}_{y,i,j-1/2,k} \right) \\ B^{n+1/2}_{z,i,j,k,} = \frac{1}{2} \left( B^{n+1/2}_{z,i,j,k+1/2} + B^{n+1/2}_{z,i,j,k-1/2} \right) \\ \end{aligned}\]<h2 id="6-half-time-step-second-order-reconstruction">6. Half Time-step Second Order Reconstruction</h2><p>Now we need to perform the high order reconstruction. I will show the algorithm for a second order (Piecewise Linear Method, PLM) reconstruction though any method should work. Note that at a given face only the transverse components of the electric field need to be reconstructed. The longitudinal component is already given at the face.</p><ol><li>Convert to primitive variables<li>Compute the limited slopes of all the primitive variables (except the transverse magnetic field). Stone &amp; Gardiner 2009 suggests minmod but any TVD limiter should work fine<li><p>Compute the interface states using</p>\[\begin{aligned} \vec{W}_{L, i+1/2} = \vec{W}_{i} + \frac{\delta \vec{W}_{i}^m}{2} \\ \vec{W}_{R, i-1/2} = \vec{W}_{i} - \frac{\delta \vec{W}_{i}^m}{2} \\ \end{aligned}\]<p>where \( \vec{W}_{L/R, i+1/2} \) is the state on the left or right side of the cell and \( \delta \vec{W}_{i}^m \) is the monotonically limited slope.</p></ol><h2 id="7-second-riemann-solve">7. Second Riemann Solve</h2><p>Solve the Riemann problem again with the half time step MHD interface states from step 6.</p><h2 id="8-compute-the-constrained-transport-electric-fields">8. Compute the Constrained Transport Electric Fields</h2><p>Repeat step 3 but using the fluxes from the second Riemann solve and the half time step MHD variables.</p><h2 id="9-perform-the-full-time-step-update">9. Perform the Full Time-step Update</h2><p>Update all the hydro variables using the below equations. Note that this is almost identical to step 3 except we’re updating the \( t = n \) state with the \( t=n+1/2 \) fluxes/CT fields instead of the \( t=n \) fluxes/CT fields.</p>\[\begin{aligned} \vec{U}^{n+1}_{i,j,k} = \vec{U}^{n}_{i,j,k} - \frac{\delta t}{\delta x} \left( \vec{F}^{n+1/2}_{x,i+1/2,j,k} - \vec{F}^{n+1/2}_{x,i-1/2,j,k} \right) \\ - \frac{\delta t}{\delta y} \left( \vec{F}^{n+1/2}_{y,i+1/2,j,k} - \vec{F}^{n+1/2}_{y,i-1/2,j,k} \right) \\ - \frac{\delta t}{\delta z} \left( \vec{F}^{n+1/2}_{z,i+1/2,j,k} - \vec{F}^{n+1/2}_{z,i-1/2,j,k} \right). \end{aligned}\]<p>Update the magnetic field using these equations</p>\[\begin{aligned} B^{n+1}_{x,i-1/2,j,k} = B^{n}_{x,i-1/2,j,k} - \frac{\delta t}{\delta y} \left( \mathcal{E}^{n+1/2}_{z,i-1/2,j+1/2,k} - \mathcal{E}^{n+1/2}_{z,i-1/2,j-1/2,k} \right) \\ + \frac{\delta t}{\delta z} \left( \mathcal{E}^{n+1/2}_{y,i-1/2,j,k+1/2} - \mathcal{E}^{n+1/2}_{y,i-1/2,j,k-1/2} \right) \end{aligned}\] \[\begin{aligned} B^{n+1}_{y,i,j-1/2,k} = B^{n}_{y,i,j-1/2,k} + \frac{\delta t}{\delta x} \left( \mathcal{E}^{n+1/2}_{z,i+1/2,j-1/2,k} - \mathcal{E}^{n+1/2}_{z,i-1/2,j-1/2,k} \right) \\ - \frac{\delta t}{\delta z} \left( \mathcal{E}^{n+1/2}_{x,i,j-1/2,k+1/2} - \mathcal{E}^{n+1/2}_{x,i,j-1/2,k-1/2} \right) \end{aligned}\] \[\begin{aligned} B^{n+1}_{z,i-1/2,j,k} = B^{n}_{z,i-1/2,j,k} - \frac{\delta t}{\delta x} \left( \mathcal{E}^{n+1/2}_{y,i+1/2,j,k-1/2} - \mathcal{E}^{n+1/2}_{y,i-1/2,j,k-1/2} \right) \\ + \frac{\delta t}{\delta y} \left( \mathcal{E}^{n+1/2}_{x,i,j+1/2,k-1/2} - \mathcal{E}^{n+1/2}_{x,i,j-1/2,k-1/2} \right). \end{aligned}\]<h2 id="10-increment-the-time-by--delta-t-">10. Increment the Time by \( \delta t \)</h2><p>And that’s it! Just loop this until you’ve reached or exceed max time and you’re done!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/mhd/'>MHD</a>, <a href='/categories/recontruction/'>Recontruction</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mhd/" class="post-tag no-text-decoration" >MHD</a> <a href="/tags/hydro/" class="post-tag no-text-decoration" >Hydro</a> <a href="/tags/computational-methods/" class="post-tag no-text-decoration" >Computational Methods</a> <a href="/tags/numerical-methods/" class="post-tag no-text-decoration" >Numerical Methods</a> <a href="/tags/riemann-solver/" class="post-tag no-text-decoration" >Riemann Solver</a> <a href="/tags/van-leer/" class="post-tag no-text-decoration" >Van Leer</a> <a href="/tags/vl-ct/" class="post-tag no-text-decoration" >VL+CT</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=VL+CT Algorithm - Robert 'Bob' Caddy&url=https://robertcaddy.com/posts/VL+CT-Algorithm/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=VL+CT Algorithm - Robert 'Bob' Caddy&u=https://robertcaddy.com/posts/VL+CT-Algorithm/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=VL+CT Algorithm - Robert 'Bob' Caddy&url=https://robertcaddy.com/posts/VL+CT-Algorithm/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/VL+CT-Algorithm/">VL+CT Algorithm</a><li><a href="/posts/Classes-and-bugfixing-6/">Classes and Bugfixing 6</a><li><a href="/posts/Research-So-Far/">Research So Far</a><li><a href="/posts/Van-Leer-and-HLLC/">Van Leer and HLLC</a><li><a href="/posts/Finished-Van-Leer/">Van Leer & HLLC Part 2</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/astronomical-techniques/">Astronomical Techniques</a> <a class="post-tag" href="/tags/riemann-solver/">Riemann Solver</a> <a class="post-tag" href="/tags/constrained-transport/">Constrained Transport</a> <a class="post-tag" href="/tags/general-relativity/">General Relativity</a> <a class="post-tag" href="/tags/bugs/">Bugs</a> <a class="post-tag" href="/tags/hlld/">HLLD</a> <a class="post-tag" href="/tags/mhd/">MHD</a> <a class="post-tag" href="/tags/computational-methods/">Computational Methods</a> <a class="post-tag" href="/tags/hydro/">Hydro</a> <a class="post-tag" href="/tags/numerical-methods/">Numerical Methods</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HLLD-Algorithm/"><div class="card-body"> <span class="timeago small" > Oct 23, 2020 <i class="unloaded">2020-10-23T16:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HLLD Algorithm</h3><div class="text-muted small"><p> Overview This is a step through of the HLLD Riemann solver I’m going to add to my hydro-sandbox code. The specific algorithm is from Miyoshi &amp; Kusano 2005 which is the original paper where the...</p></div></div></a></div><div class="card"> <a href="/posts/HLLC-Algorithm/"><div class="card-body"> <span class="timeago small" > Oct 8, 2020 <i class="unloaded">2020-10-08T17:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HLLC Algorithm</h3><div class="text-muted small"><p> Overview This is a step through of the particular HLLC Riemann solver I’m going to add to my hydro-sandbox code. It will serve as a base and teaching tool for my future implementation of an HLLD M...</p></div></div></a></div><div class="card"> <a href="/posts/Research-So-Far/"><div class="card-body"> <span class="timeago small" > Aug 31, 2020 <i class="unloaded">2020-08-31T11:12:26-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Research So Far</h3><div class="text-muted small"><p> Overview This is my first post so I’m going to summarize what I’ve done this year and what my plans are for the near future. I spent the spring semester mostly taking taking classes. When I had t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HLLD-Debugging-and-Exam/" class="btn btn-outline-primary" prompt="Older"><p>HLLD Debugging and Exam</p></a> <a href="/posts/CT-and-committee-meeting/" class="btn btn-outline-primary" prompt="Newer"><p>CT and First Committee Meeting</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/bcaddy">Robert Caddy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/astronomical-techniques/">Astronomical Techniques</a> <a class="post-tag" href="/tags/riemann-solver/">Riemann Solver</a> <a class="post-tag" href="/tags/constrained-transport/">Constrained Transport</a> <a class="post-tag" href="/tags/general-relativity/">General Relativity</a> <a class="post-tag" href="/tags/bugs/">Bugs</a> <a class="post-tag" href="/tags/hlld/">HLLD</a> <a class="post-tag" href="/tags/mhd/">MHD</a> <a class="post-tag" href="/tags/computational-methods/">Computational Methods</a> <a class="post-tag" href="/tags/hydro/">Hydro</a> <a class="post-tag" href="/tags/numerical-methods/">Numerical Methods</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://robertcaddy.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
